<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.cosmo.mapper.HiwariKinmuchiMapper">



	<!-- 여기부터 킨무지 -->
	<!-- 申請前：SHAIN + SHOZOKU -->
	<select id="getBeforeShinsei"
		resultType="org.cosmo.domain.HiwariKinmuchiVO">
		SELECT
		-- 勤務先コード（現勤務地）
		s.SHOZOKU_CD AS genKinmusakiCd,

		-- 勤務先名（現勤務地）
		z.SHOZOKU_NM AS genKinmusakiNm,

		-- 郵便番号（現勤務地）
		s.KINMU_ZIP_CD AS genKinmuZip,

		-- 都道府県（現勤務地）
		s.KINMU_ADDRESS_1 AS genKinmuAddress1,

		-- 所在地１（現勤務地）
		s.KINMU_ADDRESS_2 AS genKinmuAddress2,

		-- 所在地２（現勤務地）
		s.KINMU_ADDRESS_3 AS genKinmuAddress3,


		-- 日割期間 勤務地 쪽은 신청 전에는 없음 → NULL
		NULL AS hiwariKinmusakiCd,
		NULL AS hiwariKinmusakiNm,
		NULL AS hiwariKinmuZip,
		NULL AS hiwariKinmuAddress1,
		NULL AS hiwariKinmuAddress2,
		NULL AS hiwariKinmuAddress3

		FROM SHAIN s
		LEFT JOIN SHOZOKU z
		ON z.KIGYO_CD = s.KIGYO_CD
		AND z.SHOZOKU_CD = s.SHOZOKU_CD

		WHERE s.KIGYO_CD = #{kigyoCd}
		AND s.SHAIN_UID = #{shainUid}
	</select>

	<!-- 申請後：SHINSEI + SHOZOKU -->
	<select id="getAfterShinsei"
		resultType="org.cosmo.domain.HiwariKinmuchiVO">
		SELECT
		-- ===== 現勤務地 쪽 =====
		-- 勤務先コード（現在の勤務先）
		sh.GEN_SHOZOKU_CD AS genKinmusakiCd,

		-- 勤務先名（GEN_SHOZOKU_CD 기준）
		z1.SHOZOKU_NM AS genKinmusakiNm,

		-- 郵便番号（現勤務地）
		sh.GEN_KINMU_ZIP_CD AS genKinmuZip,

		-- 都道府県（現勤務地）
		sh.GEN_KINMU_ADDRESS_1 AS genKinmuAddress1,

		-- 所在地１（現勤務地）
		sh.GEN_KINMU_ADDRESS_2 AS genKinmuAddress2,

		-- 所在地２（現勤務地）
		sh.GEN_KINMU_ADDRESS_3 AS genKinmuAddress3,


		-- ===== 日割期間 勤務地 쪽 =====
		-- 勤務先コード（日割期間）
		sh.NEW_SHOZOKU_CD AS hiwariKinmusakiCd,

		-- 勤務先名（日割期間）
		z2.SHOZOKU_NM AS hiwariKinmusakiNm,

		-- 郵便番号（日割期間 勤務地）
		sh.NEW_KINMU_ZIP_CD AS hiwariKinmuZip,

		-- 都道府県（日割期間 勤務地）
		sh.NEW_KINMU_ADDRESS_1 AS hiwariKinmuAddress1,

		-- 所在地１（日割기간 勤務地）
		sh.NEW_KINMU_ADDRESS_2 AS hiwariKinmuAddress2,

		-- 所在地２（日割기간 勤務地）
		sh.NEW_KINMU_ADDRESS_3 AS hiwariKinmuAddress3

		FROM SHINSEI sh
		LEFT JOIN SHOZOKU z1
		ON z1.KIGYO_CD = sh.KIGYO_CD
		AND z1.SHOZOKU_CD = sh.GEN_SHOZOKU_CD -- 現勤務地용

		LEFT JOIN SHOZOKU z2
		ON z2.KIGYO_CD = sh.KIGYO_CD
		AND z2.SHOZOKU_CD = sh.NEW_SHOZOKU_CD -- 日割기간용

		WHERE sh.KIGYO_CD = #{kigyoCd}
		AND sh.SHAIN_UID = #{shainUid}
		AND sh.SHINSEI_NO = #{shinseiNo}
	</select>


	<!-- 所属 리스트 -->
	<select id="getShozokuNames" resultType="string">
		SELECT SHOZOKU_NM
		FROM SHOZOKU
		WHERE KIGYO_CD = #{kigyoCd}
		ORDER BY SHOZOKU_NM
	</select>

	<!-- 여기까지 킨무지 -->


	<!-- 여기부터 어드레스 -->
	<!-- 日割住所 페이지 데이터 조회 -->
<select id="getAddressPageDataBefore" resultType="org.cosmo.domain.HiwariAddressVO">
    SELECT
        -- 상단 社宅住所 바
        TRIM(s.DB_ADDRESS_1) || ' ' || TRIM(s.DB_ADDRESS_2)  AS fullAddress,

        -- 現住所 (신청 전 → SHAIN)
        s.ZIP_CD         AS genZip,
        s.ADDRESS_1      AS genAddress1,
        s.ADDRESS_2      AS genAddress2,
        s.ADDRESS_3      AS genAddress3,

        -- 日割期間住所 없음
        NULL AS newZip,
        NULL AS newAddress1,
        NULL AS newAddress2,
        NULL AS newAddress3

    FROM SHAIN s
    LEFT JOIN SHOZOKU z
           ON z.KIGYO_CD = s.KIGYO_CD
          AND z.SHOZOKU_CD = s.SHOZOKU_CD

    WHERE s.KIGYO_CD = #{kigyoCd}
      AND s.SHAIN_UID = #{shainUid}
</select>

<select id="getAddressPageData" resultType="org.cosmo.domain.HiwariAddressVO">
    SELECT
        -- 상단 社宅住所 바
        TRIM(s.DB_ADDRESS_1) || ' ' || TRIM(s.DB_ADDRESS_2) AS fullAddress,

        -- 現住所 (신청 후 → SHINSEI.GEN_*)
        sh.GEN_ZIP_CD        AS genZip,
        sh.GEN_ADDRESS_1     AS genAddress1,
        sh.GEN_ADDRESS_2     AS genAddress2,
        sh.GEN_ADDRESS_3     AS genAddress3,

        -- 日割期間住所 (신청 후 → SHINSEI.NEW_KINMU_*)
        sh.NEW_KINMU_ZIP_CD     AS newZip,
        sh.NEW_KINMU_ADDRESS_1  AS newAddress1,
        sh.NEW_KINMU_ADDRESS_2  AS newAddress2,
        sh.NEW_KINMU_ADDRESS_3  AS newAddress3

    FROM SHAIN s
    LEFT JOIN SHINSEI sh
           ON sh.KIGYO_CD = s.KIGYO_CD
          AND sh.SHAIN_UID = s.SHAIN_UID
          AND sh.SHINSEI_NO = #{shinseiNo}

    WHERE s.KIGYO_CD = #{kigyoCd}
      AND s.SHAIN_UID = #{shainUid}
</select>

	<!-- 여기까지 어드레스 -->

</mapper>