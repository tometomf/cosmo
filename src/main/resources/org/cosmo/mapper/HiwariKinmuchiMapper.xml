<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="org.cosmo.mapper.HiwariKinmuchiMapper">

	<!-- ========================= -->
	<!-- 申請前（신청 전） -->
	<!-- ========================= -->
	<select id="getBeforeShinsei"
		resultType="org.cosmo.domain.HiwariKinmuchiVO">
		SELECT
		S.KIGYO_CD,
		S.SHAIN_UID,

		-- 所属コード（申請前）
		S.SHOZOKU_CD AS beforeShozokuCd,     <!-- ★ -->
		Z.SHOZOKU_NM AS beforeShozokuNm,     <!-- ★ -->

		-- 現勤務地（申請前）
		S.KINMU_ZIP_CD AS kinmuZipCd,
		S.KINMU_PREF_CD AS kinmuPrefCd,
		S.KINMU_ADDRESS_1 AS kinmuAddress1,
		S.KINMU_ADDRESS_2 AS kinmuAddress2

		FROM SHAIN S
		JOIN SHOZOKU Z
		ON Z.KIGYO_CD = S.KIGYO_CD
		AND Z.SHOZOKU_CD = S.SHOZOKU_CD
		WHERE S.KIGYO_CD = #{kigyoCd}
		AND S.SHAIN_UID = #{shainUid}
	</select>

	<!-- ========================= -->
	<!-- 申請後（신청 후） -->
	<!-- ========================= -->
<select id="getAfterShinsei" resultType="org.cosmo.domain.HiwariKinmuchiVO">
    SELECT
        SS.KIGYO_CD,
        SS.SHAIN_UID,

        -- 現所属コード（申請後）
        SS.GEN_SHOZOKU_CD AS afterShozokuCd,   <!-- ★ -->
        Z.SHOZOKU_NM      AS afterShozokuNm,   <!-- ★ -->

        -- 新勤務地（申請後）
        SS.GEN_KINMU_ZIP_CD     AS kinmuZipCd,
        SS.GEN_KINMU_ADDRESS_1  AS kinmuAddress1,
        SS.GEN_KINMU_ADDRESS_2  AS kinmuAddress2

    FROM SHINSEI SS
    LEFT JOIN SHOZOKU Z
      ON Z.KIGYO_CD = SS.KIGYO_CD
     AND Z.SHOZOKU_CD = SS.GEN_SHOZOKU_CD
    WHERE SS.KIGYO_CD = #{kigyoCd}
      AND SS.SHAIN_UID = #{shainUid}
      AND SS.SHINSEI_NO = #{shinseiNo}
</select>

</mapper>