<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.cosmo.mapper.TokureiMapper">

	<insert id="insertShinsei" parameterType="org.cosmo.domain.ShinseiDTO">	
	
		<selectKey keyProperty="shinseiNo" resultType="long" order="BEFORE">
      		 SELECT NVL(MAX(SHINSEI_NO), 1000) + 1 
       		 FROM SHINSEI
       		 WHERE KIGYO_CD = #{kigyoCd}
    	</selectKey>
	
        INSERT INTO SHINSEI (
            KIGYO_CD, SHINSEI_NO, SHAIN_NO, SHAIN_UID,
            SHINSEI_KBN, SHINSEI_YMD, RIYO_START_YMD, RIYO_END_YMD,
            GEN_ZIP_CD, GEN_ADDRESS_1, GEN_ADDRESS_2, GEN_ADDRESS_3,
            NEW_ZIP_CD, NEW_ADDRESS_1, NEW_ADDRESS_2, NEW_ADDRESS_3,
            ADDRESS_CHG_KBN, KINMU_ADDRESS_CHG_KBN, KYUSHOKU_HUKKI_KBN,
            GEN_SHOZOKU_CD, NEW_SHOZOKU_CD,
            GEN_KINMU_ZIP_CD, GEN_KINMU_ADDRESS_1, GEN_KINMU_ADDRESS_2, GEN_KINMU_ADDRESS_3, GEN_KINMU_PREF_CD,
            NEW_KINMU_ZIP_CD, NEW_KINMU_ADDRESS_1, NEW_KINMU_ADDRESS_2, NEW_KINMU_ADDRESS_3, NEW_KINMU_PREF_CD,
            TSUKINRO_NO, JITSU_KM, SHINCHOKU_KBN, JUTAKU_KBN, ALERT_UMU,
            TOKU_SHINSEI_RIYU, SHINSEI_RIYU,
            ADD_USER_ID, ADD_DATE, UPD_USER_ID, UPD_DATE
        ) VALUES (
            #{kigyoCd}, #{shinseiNo}, #{shainNo}, #{shainUid},
            #{shinseiKbn}, #{shinseiYmd}, #{riyoStartYmd}, #{riyoEndYmd},
            #{genZipCd}, #{genAddress1}, #{genAddress2}, #{genAddress3},
            #{newZipCd}, #{newAddress1}, #{newAddress2}, #{newAddress3},
            #{addressChgKbn}, #{kinmuAddressChgKbn}, #{kyushokuHukkiKbn},
            #{genShozokuCd}, #{newShozokuCd},
            #{genKinmuZipCd}, #{genKinmuAddress1}, #{genKinmuAddress2}, #{genKinmuAddress3}, #{genKinmuPrefCd},
            #{newKinmuZipCd}, #{newKinmuAddress1}, #{newKinmuAddress2}, #{newKinmuAddress3}, #{newKinmuPrefCd},
            #{tsukinroNo}, #{jitsuKm}, #{shinchokuKbn}, #{jutakuKbn}, #{alertUmu},
            #{tokuShinseiRiyu}, #{shinseiRiyu},
            #{addUserId}, SYSTIMESTAMP, #{updUserId}, SYSTIMESTAMP
        )
    </insert>

    <update id="updateShinsei" parameterType="org.cosmo.domain.ShinseiDTO">
        UPDATE SHINSEI
        SET
            SHINSEI_KBN = #{shinseiKbn},
            SHINSEI_YMD = #{shinseiYmd},
            RIYO_START_YMD = #{riyoStartYmd},
            RIYO_END_YMD = #{riyoEndYmd},
            
            GEN_ZIP_CD = #{genZipCd}, GEN_ADDRESS_1 = #{genAddress1}, GEN_ADDRESS_2 = #{genAddress2},
            NEW_ZIP_CD = #{newZipCd}, NEW_ADDRESS_1 = #{newAddress1}, NEW_ADDRESS_2 = #{newAddress2},
            ADDRESS_CHG_KBN = #{addressChgKbn},
            
            TSUKINRO_NO = #{tsukinroNo},
            JITSU_KM = #{jitsuKm},
            SHINCHOKU_KBN = #{shinchokuKbn},
            
            TOKU_SHINSEI_RIYU = #{tokuShinseiRiyu}, -- 특례사유 수정
            ALERT_UMU = #{alertUmu},
            
            UPD_USER_ID = #{updUserId},
            UPD_DATE = SYSTIMESTAMP
        WHERE
            KIGYO_CD = #{kigyoCd}
            AND SHINSEI_NO = #{shinseiNo}
    </update>
    
    
    <insert id="insertStartKeiro" parameterType="org.cosmo.domain.ShinseiStartKeiroVO">
        INSERT INTO SHINSEI_START_KEIRO (
            KIGYO_CD,
            SHINSEI_NO,
            KEIRO_SEQ,
            
            TSUKIN_SHUDAN_KBN,
            START_PLACE,
            END_PLACE,
            SHINSEI_KM,
            
            -- (필요한 컬럼들 추가)
            YURYO_TOKUREI,
            KYORI_KAGEN_TOKUREI,
            JOUGEN_KINGAKU_TOKUREI,
            JOUGEN_CUT,
            FUBI_UMU_KBN,
            
            KIKAN_START_YMD,
            KIKAN_END_YMD,
            JITSU_KINMU_NISSU,
            
            KEKKA_SELECT,
            
            FIRST_TEIKI_TSUKI_SU,
            FIRST_SHIKYU_YMD,
            FIRST_SHIKYU_KIN,
            NEXT_TEIKI_TSUKI_SU,
            REGULAR_SHIKYU_KIN,
            TSUKI_SHIKYU_KIN,
            KATAMICHI_KIN,
            
            SHINKANSEN_RIYO_KBN,
            TOKKYU_RIYO_KBN,
            YURYO_RIYO_KBN,
            
            SANSHO_TEIKI_TSUKI_SU_1, SANSHO_TEIKI_KIN_1,
            SANSHO_TEIKI_TSUKI_SU_2, SANSHO_TEIKI_KIN_2,
            SANSHO_TEIKI_TSUKI_SU_3, SANSHO_TEIKI_KIN_3,
            
            YURYO_OFUKU_KBN,
            YURYO_KATAMICHI_KIN,
            
            NENPI,
            GASORIN_DAI_MAE, YURYO_DAI_MAE, GOUKEI_MAE, HIWARI_MAE,
            GASORIN_DAI_ATO, YURYO_DAI_ATO, GOUKEI_ATO, HIWARI_ATO,
            
            ADD_USER_ID,
            ADD_DATE
        ) VALUES (
            #{kigyoCd},
            #{shinseiNo},   -- Service에서 넣어준 번호가 들어감
            1,              -- 순번 1번 고정
            
            #{tsukinShudanKbn},
            #{startPlace},
            #{endPlace},
            #{shinseiKm},
            
            #{yuryoTokurei},
            #{kyoriKagenTokurei},
            #{jougenKingakuTokurei},
            #{jougenCut},
            #{fubiUmuKbn},
            
            #{kikanStartYmd},
            #{kikanEndYmd},
            #{jitsuKinmuNissu},
            
            #{kekkaSelect},
            
            #{firstTeikiTsukiSu},
            #{firstShikyuYmd},
            #{firstShikyuKin},
            #{nextTeikiTsukiSu},
            #{regularShikyuKin},
            #{tsukiShikyuKin},
            #{katamichiKin},
            
            #{shinkansenRiyoKbn},
            #{tokkyuRiyoKbn},
            #{yuryoRiyoKbn},
            
            #{sanshoTeikiTsukiSu1}, #{sanshoTeikiKin1},
            #{sanshoTeikiTsukiSu2}, #{sanshoTeikiKin2},
            #{sanshoTeikiTsukiSu3}, #{sanshoTeikiKin3},
            
            #{yuryoOfukuKbn},
            #{yuryoKatamichiKin},
            
            #{nenpi},
            #{gasorinDaiMae}, #{yuryoDaiMae}, #{goukeiMae}, #{hiwariMae},
            #{gasorinDaiAto}, #{yuryoDaiAto}, #{goukeiAto}, #{hiwariAto},
            
            #{addUserId},
            SYSTIMESTAMP
        )
    </insert>
    
    
    <insert id="insertEndKeiro" parameterType="org.cosmo.domain.ShinseiEndKeiroVO">
    INSERT INTO SHINSEI_END_KEIRO (
        KIGYO_CD, SHINSEI_NO, KEIRO_SEQ,
        TSUKIN_SHUDAN_KBN, FUBI_UMU_KBN, GEN_TSUKINRO_NO,
        RIYO_END_YMD, KIKAN_START_YMD, KIKAN_END_YMD,
        JITSU_KINMU_NISSU, SHINSEI_KIN,
        JR_MODOSHI_KBN, MODOSHI_KIN, MODOSHI_FILE_UID,
        ADD_USER_ID, ADD_DATE
    ) VALUES (
        #{kigyoCd}, #{shinseiNo}, 1,
        #{tsukinShudanKbn}, #{fubiUmuKbn}, #{genTsukinroNo},
        #{riyoEndYmd}, #{kikanStartYmd}, #{kikanEndYmd},
        #{jitsuKinmuNissu}, #{shinseiKin},
        #{jrModoshiKbn}, #{modoshiKin}, #{modoshiFileUid},
        #{addUserId}, SYSTIMESTAMP
    )
</insert>

<insert id="insertFuzuiShorui" parameterType="org.cosmo.domain.ShinseiFuzuiShoruiDTO">
        INSERT INTO SHINSEI_FUZUI_SHORUI (
            KIGYO_CD, SHINSEI_NO, KEIRO_SEQ,
            SHINSEI_KBN, SHINSEI_YMD, SHAIN_UID, SHAIN_NO, DAIRI_SHINSEISHA_CD,
            TSUKIN_SHUDAN_KBN,
            FILE_UID_1, FILE_UID_2, FILE_UID_3, FILE_UID_4, FILE_UID_5,
            MENKYO_YUKO_KIGEN, MENKYO_NO, SHASHU, TOROKU_NO, HAIKIRYO, SHAKEN_YUKO_KIGEN, NENPI,
            HOKEN_MANRYO_YMD, TAIJIN_BAISHO, TAIBUTSU_BAISHO, JINSHIN_SHOGAI, TOJOSHA_SHOGAI, TOKYU,
            FIRST_TEIKI_KIKAN, NEXT_TEIKI_KIKAN,
            ADD_USER_ID, ADD_DATE
        ) VALUES (
    #{kigyoCd}, #{shinseiNo}, 1,
    #{shinseiKbn, jdbcType=VARCHAR}, 
    #{shinseiYmd, jdbcType=VARCHAR}, 
    #{shainUid}, #{shainNo}, 
    #{dairiShinseishaCd, jdbcType=INTEGER}, 
    #{tsukinShudanKbn, jdbcType=VARCHAR},
    
    #{fileUid1, jdbcType=INTEGER}, #{fileUid2, jdbcType=INTEGER}, 
    #{fileUid3, jdbcType=INTEGER}, #{fileUid4, jdbcType=INTEGER}, #{fileUid5, jdbcType=INTEGER},
    
    #{menkyoYukoKigen, jdbcType=VARCHAR}, #{menkyoNo, jdbcType=VARCHAR}, 
    #{shashu, jdbcType=VARCHAR}, #{torokuNo, jdbcType=VARCHAR}, 
    #{haikiryo, jdbcType=INTEGER}, #{shakenYukoKigen, jdbcType=VARCHAR}, #{nenpi, jdbcType=DECIMAL},
    
    #{hokenManryoYmd, jdbcType=VARCHAR}, #{taijinBaisho, jdbcType=VARCHAR}, 
    #{taibutsuBaisho, jdbcType=VARCHAR}, #{jinshinShogai, jdbcType=VARCHAR}, 
    #{tojoshaShogai, jdbcType=VARCHAR}, #{tokyu, jdbcType=INTEGER},
    
    #{firstTeikiKikan, jdbcType=VARCHAR}, #{nextTeikiKikan, jdbcType=VARCHAR},
    
    #{addUserId}, SYSTIMESTAMP
)
    </insert>


</mapper>

<!-- 作成者 : 권예성 -->