<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.cosmo.mapper.AddressInputMapper">

   <select id="selectShainAddress" resultType="org.cosmo.domain.AddressViewDto">
        SELECT 
            /* 현주소 (여기는 1,2,3 다 있음) */
            ZIP_CD      AS currentZip,
            ADDRESS_1   AS currentPref,
            ADDRESS_2   AS currentAddr1,
            ADDRESS_3   AS currentAddr2,
            
            /* 중간주소 (여기는 1,2만 있음!) */
            DB_ZIP_CD     AS middleZip,
            DB_ADDRESS_1  AS middlePref,   /* 도도부현 */
            DB_ADDRESS_2  AS middleAddr1,  /* 시구정촌+건물명 */
            
            
            NULL          AS middleAddr2   
        FROM SHAIN
        WHERE SHAIN_UID = #{shainUid}
    </select>

    <insert id="saveIchijiHozon">
        INSERT INTO ICHIJI_HOZON (
            "UID",
            USER_UID,
            SHINSEI_KBN,
            SHOZOKU_CD,
            ACTION_NM,
            DATA,
            ADD_USER_ID,
            ADD_DATE,
            UPD_USER_ID,
            UPD_DATE
        ) VALUES (
            ICHIJI_HOZON_SEQ.NEXTVAL, 
            #{userUid}, 
            #{shinseiKbn, jdbcType=VARCHAR},    
            #{shozokuCd, jdbcType=VARCHAR},    
            #{actionNm, jdbcType=VARCHAR},      
            #{data, jdbcType=CLOB}, 
            #{addUserId, jdbcType=VARCHAR},    
            SYSDATE,
            #{addUserId, jdbcType=VARCHAR},
            SYSDATE
        )
    </insert>

    <insert id="insertOshirase">
        INSERT INTO OSHIRASE (
            KIGYO_CD,
            SHAIN_UID,
            SHAIN_NO,
            TSUCHI_YMD,
            TSUCHI_HM,
            TSUCHISHA_KIGYO_CD,
            TSUCHISHA_CD,
            SHINSEI_NO,         
            OSHIRASE_NAIYO,     
            KENGEN,             
            ADD_USER_ID,
            ADD_DATE,
            UPD_USER_ID,
            UPD_DATE
        ) VALUES (
            #{kigyoCd},
            #{shainUid},
            #{shainNo},
            TO_CHAR(SYSDATE, 'YYYYMMDD'),
            TO_CHAR(SYSDATE, 'HH24MI'), 
            #{kigyoCd},
            #{shainNo},
            
            /* [특기사항] 신청번호는 NULL */
            NULL,               
            
            /* [특기사항] 내용은 고정 텍스트: "一時保存しました。" */
            '一時保存しました。', 
            
            /* [특기사항] 권한은 NULL */
            NULL,               
            
            #{shainUid},
            SYSDATE,
            #{shainUid},
            SYSDATE
        )
    </insert>

    <insert id="insertProcessLog">
        INSERT INTO PROCESS_LOG (
            PROCESS_TIMESTAMP,
            SUBSYSTEM_ID,
            PROCESS,
            KEY1,               
            KEY2,               
            KEY3,
            KEY4,
            KEY5,               
            DATA,               
            USER_UID,
            USER_TRACK
        ) VALUES (
            SYSDATE,
            '05',               /* 서브시스템 ID */
            '0400',             /* 화면 ID */
            
            /* [특기사항] KEY1: 신청번호 (일시저장시: 0 고정) */
            '0',                
            
            #{shinseiKbn},      /* KEY2: 신청구분코드 */
            NULL,
            NULL,
            
            /* [특기사항] KEY5: 세션 기업코드 */
            #{kigyoCd},         
            
            /* [특기사항] DATA: 미사용 (NULL) */
            NULL,               
            
            #{userUid},
            #{userIp}
        )
    </insert>

    <select id="selectZipCode" resultType="java.util.HashMap">
        SELECT 
            ZIP_TODO || ZIP_SHIK || ZIP_ADRS AS "PREF_NAME", 
            ZIP_ADRS2 AS "ADDR_NAME"
        FROM LEO_ZIP 
        WHERE ZIP_CODE = #{zipCode} 
    </select>

</mapper>