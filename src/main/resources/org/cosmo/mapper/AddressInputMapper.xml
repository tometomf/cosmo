<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.cosmo.mapper.AddressInputMapper">

    <select id="selectCurrentAddress" resultType="org.cosmo.domain.AddressViewDto">
        SELECT 
            ZIP_CD AS currentZip,
            PREF_NAME AS currentPref,
            ADDR1 AS currentAddr1,
            ADDR2 AS currentAddr2
        FROM SHAIN_MST
        WHERE SHAIN_UID = #{shainUid}
    </select>
    
   <select id="selectMiddleAddress" resultType="org.cosmo.domain.AddressViewDto">
    SELECT 
        /* 오라클 문자열 연결 연산자 || 사용 */
        PREF || ADDR1 || ADDR2 AS middleDbAddress,
        ZIP1 AS middleZip1,
        ZIP2 AS middleZip2,
        PREF AS middlePref,
        ADDR1 AS middleAddr1,
        ADDR2 AS middleAddr2
    FROM MIDDLE_DB_TABLE
    WHERE SHAIN_UID = #{shainUid}
</select>

   <update id="saveIchijiHozon">
        MERGE INTO ICHIJI_HOZON T
        USING DUAL
        ON (T.USER_UID = #{userUid} AND T.ACTION_NM = #{actionNm})
        
        WHEN MATCHED THEN
            UPDATE SET 
                DATA = #{data}, 
                UPD_DATE = SYSDATE
                
        WHEN NOT MATCHED THEN
            INSERT (
                HOZON_ID,      USER_UID, 
                ACTION_NM, 
                DATA, 
                ADD_DATE,
                UPD_DATE
            )
            VALUES (
                SEQ_ICHIJI.NEXTVAL,  #{userUid}, 
                #{actionNm}, 
                #{data}, 
                SYSDATE,
                SYSDATE
            )
    </update>
    
    <insert id="insertOshirase">
        INSERT INTO OSHIRASE_TBL (SHAIN_UID, MSG, ADD_DATE)
        VALUES (#{shainUid}, #{message}, SYSDATE)
    </insert>

</mapper>