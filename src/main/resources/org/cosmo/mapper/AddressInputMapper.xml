<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.cosmo.mapper.AddressInputMapper">

    <select id="selectCurrentAddress" resultType="org.cosmo.domain.AddressViewDto">
        SELECT 
            ZIP_CD      AS currentZip,
            PREF_NAME   AS currentPref,
            ADDR1       AS currentAddr1,
            ADDR2       AS currentAddr2
        FROM SHAIN
        WHERE SHAIN_UID = #{shainUid}
          AND KIGYO_CD = #{kigyoCd}  </select>

    <select id="selectMiddleAddress" resultType="org.cosmo.domain.AddressViewDto">
        SELECT 
            ZIP1   AS middleZip1,    /* 앞 3자리 */
            ZIP2   AS middleZip2,    /* 뒤 4자리 */
            PREF   AS middlePref,    /* 도도부현 */
            ADDR1  AS middleAddr1,   /* 시구정촌 */
            ADDR2  AS middleAddr2    /* 건물명 */
        FROM MIDDLE_DB_TABLE  WHERE SHAIN_UID = #{shainUid}
    </select>
    
    <insert id="saveIchijiHozon">
        INSERT INTO ICHIJI_HOZON (
            UID,                USER_UID,
            SHINSEI_KBN,
            SHOZOKU_CD,
            ACTION_NM,
            DATA,
            ADD_USER_ID,
            ADD_DATE,
            UPD_USER_ID,        UPD_DATE
        ) VALUES (
            SEQ_ICHIJI_HOZON.NEXTVAL,
            #{userUid, jdbcType=VARCHAR},
            #{shinseiKbn, jdbcType=VARCHAR},
            #{shozokuCd, jdbcType=VARCHAR},
            #{actionNm, jdbcType=VARCHAR},
            #{data, jdbcType=CLOB},
            #{addUserId, jdbcType=VARCHAR},
            SYSDATE,
            #{addUserId, jdbcType=VARCHAR}, SYSDATE
        )
    </insert>

    <insert id="insertOshirase">
        INSERT INTO OSHIRASE (
            KIGYO_CD,
            SHAIN_UID,
            SHAIN_NO,           TSUCHI_YMD,
            TSUCHI_HM,
            TSUCHISHA_KIGYO_CD, TSUCHISHA_CD,       SHINSEI_NO,         OSHIRASE_NAIYO,
            KENGEN,             ADD_USER_ID,
            ADD_DATE,
            UPD_USER_ID,        UPD_DATE
        ) VALUES (
            #{kigyoCd},         #{shainUid},
            #{shainNo},         TO_CHAR(SYSDATE, 'YYYYMMDD'),
            TO_CHAR(SYSDATE, 'HH24MISS'),
            #{kigyoCd},         #{shainNo},         NULL,               #{message},
            NULL,               #{shainUid},
            SYSDATE,
            #{shainUid},
            SYSDATE
        )
    </insert>

    <insert id="insertProcessLog">
        INSERT INTO PROCESS_LOG (
            PROCESS_TIMESTAMP,  SUBSYSTEM_ID,       PROCESS,            KEY1,               KEY2,               KEY3,               KEY4,               KEY5,               DATA,               USER_UID,           USER_TRACK          ) VALUES (
            SYSDATE,
            'COMMUTE_MGR',      '0400',             '0',                #{shinseiKbn},      NULL,
            NULL,
            #{kigyoCd},         NULL,
            #{userUid},
            #{userIp}           )
    </insert>

    <select id="selectZipCode" resultType="java.util.HashMap">
        SELECT 
            PREF_NAME AS "PREF_NAME", 
            ADDR_NAME AS "ADDR_NAME"
        FROM LEO_ZIP 
        WHERE ZIP_CD1 = #{zip1} 
          AND ZIP_CD2 = #{zip2}
    </select>

</mapper>